apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - deployment.yaml
  - ingress.yaml
  - service.yaml

images:
  - name: {{ACCOUNT_ID}}.dkr.ecr.{{REGION}}.amazonaws.com/keycloak
    newTag: {{IMAGE_HASH}}

namespace: default

configMapGenerator:
  - name: keycloak-config
    literals:
      - KEYCLOAK_FRONTEND_URL=https://auth.{{DOMAIN_NAME}}
      - PROXY_ADDRESS_FORWARDING=true

secretGenerator:
  - name: keycloak-secret
    literals:
      - admin-password=your_admin_password_here

  - name: keycloak-db-secret
    literals:
      - db-password=your_db_password_here

  - name: tls-secret
    files:
      - tls.crt=path/to/tls.crt
      - tls.key=path/to/tls.key

generatorOptions:
  disableNameSuffixHash: true
